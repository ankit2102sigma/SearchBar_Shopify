<div class="predictive-search__results">
  <div id="search-results-container"></div>
</div>

<script>
  // Get the search input from the URL query parameters
  const urlParams = new URLSearchParams(window.location.search);
  const searchInput = urlParams.get('q');

  fetch(`http://localhost:8000/api/search?q=${searchInput}`)
    .then(response => response.json())
    .then(data => {
      const searchResultsContainer = document.getElementById('search-results-container');
      searchResultsContainer.innerHTML = ''; // Clear the container before appending results

      if (data.length > 0) {
        const searchResultHeading = document.createElement('h1');
        searchResultHeading.id = 'heading-search-result';
        searchResultHeading.textContent = 'Search Result';
        searchResultsContainer.appendChild(searchResultHeading);

        data.forEach(result => {
          const listItem = document.createElement('div');
          listItem.id = 'product-data-search';

          const link = document.createElement('a');
          const image = document.createElement('img');
          image.id = 'product-image-search';
          image.src = result.image;
          image.alt = result.title;
          link.href = `https://laptopifyy.myshopify.com/products/${result.handle}`;

          const truncatedTitleLength = 20; // Adjust the desired length for truncation
          const truncatedTitle = result.title.length > truncatedTitleLength
            ? result.title.substring(0, truncatedTitleLength) + '...' 
            : result.title;

          link.textContent = truncatedTitle;
          listItem.appendChild(image);
          listItem.appendChild(link);

          if (result.title.length > truncatedTitleLength) {
            const readMoreLink = document.createElement('a');
            readMoreLink.href = `https://laptopifyy.myshopify.com/products/${result.handle}`;
            readMoreLink.textContent = 'Read More';
            listItem.appendChild(readMoreLink);
          }

          searchResultsContainer.appendChild(listItem);
        });
      } else {
        const noResultsMessage = document.createElement('h1');
        noResultsMessage.id = 'heading-search-result';
        noResultsMessage.textContent = 'No Search Result found';
        searchResultsContainer.appendChild(noResultsMessage);
      }
    })
    .catch(error => console.error(error));
</script>
