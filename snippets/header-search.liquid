{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
HEADER SEARCH
----------------------------------------------------------------------------------------------------------------------

Code of the predictive search in the header. This uses the "predictive-search" component. The resources being
searched are controlled by the Search & Discovery app.

********************************************
Supported variables
********************************************

Nothing
{%- endcomment -%}

<script>
document.getElementByClassName('header-find').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const searchInput = document.getElementById('header-find').value;
    if (searchInput.length >= 3) {
        fetch(`http://localhost:8000/api/search?q=${searchInput}`)
            .then(response => response.json())
            .then(data => {
                const resultsContainer = document.getElementById('result-search__content');
                resultsContainer.innerHTML = '';
                
                if (data.length > 0) {
                    data.slice(0, 4).forEach(result => {
                        const listItem = document.createElement('li');
                        listItem.textContent = result.name;
                        resultsContainer.appendChild(listItem);
                    });
                    
                    if (data.length > 4) {
                        const showMoreItem = document.createElement('li');
                        showMoreItem.textContent = 'Show More';
                        resultsContainer.appendChild(showMoreItem);
                    }
                } else {
                    const noResultsItem = document.createElement('li');
                    noResultsItem.textContent = 'No results found';
                    resultsContainer.appendChild(noResultsItem);
                }
            })
            .catch(error => console.error(error));
    }
});
</script>
<header-search id="header-search-{{ section.id }}" class="header-find">
  <div class="container">
    <form id="predictive-search-form" action="{{ routes.search_url }}" method="GET" aria-owns="header-predictive-search" class="header-search__form" role="search">
      <div class="header-search__form-control">
        {%- render 'icon' with 'search', width: 20 -%}
        <input type="search" name="q" spellcheck="false" class="header-search__input h5 sm:h4" aria-label="{{ 'search.general.title' | t | escape }}" placeholder="{{ 'search.general.search_placeholder' | t | escape }}">
        <button type="button" is="dialog-close-button">
          <span class="sr-only">{{ 'general.accessibility.close' | t }}</span>
          {%- render 'icon' with 'close', width: 16 -%}
        </button>
      </div>
    </form>

    <predictive-search id="header-predictive-search" class="predictive-search">
      <div class="result-search__content" slot="results"></div>
    </predictive-search>
  </div>
</header-search>